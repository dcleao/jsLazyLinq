/*  jsLazyLinq JavaScript framework, version 0.1.2
*  (c) 2010 Duarte Cunha LeÃ£o
*
*  jsLazyLinq is freely distributable under the terms of an MIT-style license.
*  For details, see the http://github.com/dcleao/jsLazyLinq
*--------------------------------------------------------------------------*/
(function(k){k.jsLazyLinq={Version:"0.1.2"};var d=Array.prototype.slice,f={},g;function c(l){return typeof l==="function"}function h(l){return l&&((l instanceof Array)||(typeof l.length==="number"&&typeof l!=="string"&&typeof l!=="function"&&!l.setTimeout))}function e(m,l){return m+l}function a(l){return l.key}function i(l){return l.value}function b(m,l){function n(q){var p=q&&q[m];return p?p.apply(q,l):undefined}return n}function qDo(o,n){var l=0;try{this._generate(function(p){o.call(n,p,l++)})}catch(m){if(m!==f){throw m}}return this}function qGenerate(l){if(this._yieldInterceptor){l=this._yieldInterceptor(l)}this._sourceGenerate.call(this._source,l)}function qNullYield(l){throw f}function qToArray(){var l=[];this.Do(function(m){l.push(m)});return l}function qCount(){var l=0;this.Do(function(){l++});return l}function qExists(){var l=false;this.Do(function(){l=true;throw f});return l}function qAny(){var l=false;this.Do(function(m){l=!!m;if(l){throw f}});return l}function qAll(){var l=true;this.Do(function(m){l=!!m;if(!l){throw f}});return l}function qFirst(){var l;this.Do(function(m){l=m;throw f});return l}function qContains(m){var l=false;this.Do(function(n){if(n===m){l=true;throw f}});return l}function qSum(){return this.Aggregate(0,e)}function qMax(){var l;this.Do(function(m){if(l==null||m>l){l=m}});return l}function qMin(){var l;this.Do(function(m){if(l==null||m<l){l=m}});return l}function qAggregate(l,n,m){this.Do(function(p,o){l=n.call(m,l,p,o)});return l}function qSelect(l,m){return this._intercept(function(n){function qSelectYield(o){n(l.call(m,o))}return qSelectYield})}function qSelectMany(l,m){return this._intercept(function(n){function qSelectManyYield(q){var o=l.call(m,q);if(o!=null){var p=$Q(o);if(p){p._generate(n)}else{n(o)}}}return qSelectManyYield})}function qWhere(l,m){return this._intercept(function(n){function qWhereYield(o){if(l.call(m,o)){n(o)}}return qWhereYield})}function qDistinct(m,l){return this._intercept(function(n){var o={};function qDistinctYield(q){var p=m?m.call(l,q):q;p+="";if(!o.hasOwnProperty(p)){o[p]=true;n(q)}}return qDistinctYield})}function qFlatten(){return this._intercept(function(l){function qFlattenYield(n){var m=$Q(n);if(m){m._generate(qFlattenYield)}else{l(n)}}return qFlattenYield})}function qTakeWhile(l,m){return this._intercept(function(n){function qTakeWhileYield(o){if(!l.call(m,o)){throw f}n(o)}return qTakeWhileYield})}function qTake(l){return this._intercept(function(m){if(l<=0){return qNullYield}function qTakeYield(n){m(n);if(!(--l)){throw f}}return qTakeYield})}function qTakeLast(l){if(l<=0){return this._intercept(function(m){return qNullYield})}function qTakeLast_generate(n){var m=this.ToArray(),p=Math.max(m.length-l,0),o=$Q(m.slice(p));o._generate(n)}return new Query(qTakeLast_generate,this)}function qSkipWhile(l,m){return this._intercept(function(n){var o=true;function qSkipWhileYield(p){if(o){if(l.call(m,p)){return}o=false}n(p)}return qSkipWhileYield})}function qSkip(l){return this._intercept(function(m){function qSkipYield(n){if(l>0){l--}else{m(n)}}return qSkipYield})}function qSkipLast(m){if(m<=0){return this}var l=this;function qSkipLast_generate(o){var n=l.ToArray(),p=$Q(n.slice(0,-m));p._generate(o)}return new Query(qSkipLast_generate)}function qConcat(){return qConcatList([this].concat(d.apply(arguments)))}function qUnion(){return qUnionList([this].concat(d.apply(arguments)))}function qGet(l){return this.Select(function(m){return m?m[l]:undefined})}function qGetExisting(l){return this._intercept(function(m){function qGetExistingYield(n){if(n&&(l in n)){m(n[l])}}return qGetExistingYield})}function qCall(l){return this.Select(b(l,d.call(arguments,1)))}function qApply(m,l){return this.Select(b(m,l))}function qKeys(){return this.Select(a)}function qValues(){return this.Select(i)}function qBreak(){return f}function qInit(l){if(l.breakSignal){f=l.breakSignal}if("getGenerator" in l){g=l.getGenerator}}function qConcatList(l){function qConcat_generate(n){for(var o=0,m=l.length;o<m;o++){var p=$Q(l[o]);if(!p){throw new Error("Cannot convert argument to Query.")}p._generate(n)}}return new Query(qConcat_generate)}function qUnionList(l,n,m){return qConcatList(l).Distinct(n,m)}function qArrayLikeGenerator(m){for(var n=0,l=this.length;n<l;n++){m(this[n])}}function $Q(l,m){if(l){if(l instanceof Query){return l}if(h(l)){return new Query(qArrayLikeGenerator,l)}if(c(l)){return new Query(l,m)}if(g){var n=g(l,m);if(n){return new Query(n,l)}}}return null}function Query(m,l,n){this._sourceGenerate=m;this._source=l;if(n){this._yieldInterceptor=n}}function j(n,q){for(var r in q){if(q.hasOwnProperty(r)){var l=q[r],m=r.charAt(0),o=r.substr(1);n[m.toLowerCase()+o]=l;n[m.toUpperCase()+o]=l}}}Query.prototype={_generate:qGenerate,_intercept:function(l){return new Query(qGenerate,this,l)},Do:qDo};j(Query.prototype,{each:qDo,toArray:qToArray,aggregate:qAggregate,count:qCount,exists:qExists,any:qAny,all:qAll,first:qFirst,contains:qContains,sum:qSum,max:qMax,min:qMin,select:qSelect,selectMany:qSelectMany,where:qWhere,distinct:qDistinct,union:qUnion,flatten:qFlatten,take:qTake,takeLast:qTakeLast,takeWhile:qTakeWhile,skip:qSkip,skipLast:qSkipLast,skipWhile:qSkipWhile,concat:qConcat,get:qGet,getExisting:qGetExisting,call:qCall,apply:qApply,keys:qKeys,values:qValues});Query.$break=Query.Break=qBreak;j(Query,{arrayLikeGenerator:qArrayLikeGenerator,create:$Q,init:qInit,concat:qConcatList,union:qUnionList});k.Query=Query;k.$Q=$Q})(this);